---
description: Create new feature with automated Git flow
---

# /new-feature - Feature Scaffolding with Git Flow

Este workflow automatiza la creaciÃ³n completa de una nueva feature siguiendo las mejores prÃ¡cticas de Git flow y arquitectura por capas.

## Pasos

### 1. Validar Rama Actual
```bash
git branch --show-current
```
**Verificar:** Debe ser `develop`. Si no, preguntar al usuario si quiere cambiar a develop.

### 2. Actualizar Develop
// turbo
```bash
git checkout develop
git pull origin develop
```

### 3. Solicitar InformaciÃ³n de la Feature
Preguntar al usuario:
- **Nombre de la feature** (ej: `autenticacion-oauth`, `rate-limiting`)
- **DescripciÃ³n breve** (para el commit inicial)
- **Tipo** (feature/bugfix/enhancement)

### 4. Crear Feature Branch
```bash
git checkout -b feature/NOMBRE-FEATURE
```

### 5. Scaffold de CÃ³digo (Arquitectura por Capas)

Consultar `.agent/CONVENTIONS.md` para la estructura correcta.

**Crear archivos en este orden:**

#### a) Domain Layer (si aplica)
```
app/domain/NOMBRE_feature.py
```
- Entidades puras
- Value Objects
- Sin dependencias externas

#### b) Infrastructure Layer
```
app/infra/NOMBRE_repository.py
```
- Repositorio para MongoDB
- Clientes externos si es necesario

#### c) Service Layer
```
app/services/NOMBRE_service.py
```
- LÃ³gica de negocio
- OrquestaciÃ³n
- **IMPORTANTE:** Imports en la raÃ­z del archivo

#### d) API Layer
```
app/api/v1/NOMBRE.py
```
- Endpoints FastAPI
- ValidaciÃ³n de DTOs
- Llamadas al servicio

### 6. Generar Templates con Imports Correctos

**Template de Service:**
```python
"""
Service for NOMBRE feature.
"""
from typing import Optional, Dict, Any
from app.infra.NOMBRE_repository import NOMBRERepository
from app.domain.NOMBRE import NOMBREEntity  # Si aplica

class NOMBREService:
    """Handles DESCRIPCION logic."""
    
    def __init__(self):
        self.repository = NOMBRERepository()
    
    async def execute(self, data: Dict[str, Any]) -> Dict[str, Any]:
        """
        Main execution method.
        
        Args:
            data: Input data
            
        Returns:
            Result dictionary
        """
        # TODO: Implement logic
        pass
```

### 7. Registrar Rutas (si es API)

Actualizar `app/main.py` para incluir el nuevo router:
```python
from app.api.v1 import NOMBRE
app.include_router(NOMBRE.router, prefix="/api/v1", tags=["NOMBRE"])
```

### 8. Commit Inicial
```bash
git add .
git commit -m "feat(NOMBRE): scaffold DESCRIPCION

Created initial structure following layered architecture:
- Domain: NOMBRE entity
- Infra: NOMBRE repository
- Service: NOMBRE service
- API: NOMBRE endpoints

ðŸ¤– Auto-generated by Antigravity
Co-authored-by: Claude Sonnet 4 <antigravity@deepmind.google>"
```

### 9. Ejecutar Validaciones
```bash
# Arquitectura
python .agent/audit_arch.py

# Linting (cuando estÃ© configurado)
# ruff check app/
```

### 10. Consultar Subagentes

**Security Audit:**
- Consultar `.agent/agents/security-audit.md`
- Verificar que se valide `user_id` en queries
- Confirmar que hay autenticaciÃ³n en endpoints

**CTO Review (si es cambio arquitectÃ³nico):**
- Consultar `.agent/agents/cto-agent.md`
- Evaluar impacto en escalabilidad

## Resultado Esperado

Al finalizar:
- âœ… Nueva rama `feature/NOMBRE` creada desde develop actualizado
- âœ… Estructura completa de archivos (Domain â†’ Infra â†’ Service â†’ API)
- âœ… Imports en la raÃ­z de todos los archivos
- âœ… Commit inicial con firma de Antigravity
- âœ… Validaciones de arquitectura pasadas
- âœ… Listo para comenzar implementaciÃ³n

## Notas

- Si el usuario solo necesita modificar cÃ³digo existente, **NO** crear nueva estructura
- Siempre seguir el orden: Domain â†’ Infra â†’ Service â†’ API
- Consultar `CONVENTIONS.md` ante cualquier duda
