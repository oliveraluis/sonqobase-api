---
description: Validate code style and apply auto-fixes
---

# /lint - Code Style Validation

Valida el estilo de c√≥digo y aplica auto-fixes cuando sea posible.

## Objetivo

Detectar y corregir:
- **Imports dentro de funciones** (deben estar en la ra√≠z)
- Formateo inconsistente
- Falta de type hints
- Docstrings faltantes
- L√≠neas muy largas (>100 caracteres)

## Pasos

### 1. Detectar Imports Incorrectos

Buscar patr√≥n de imports dentro de funciones/clases:

```python
# ‚ùå INCORRECTO
def my_function():
    import requests  # Import dentro de funci√≥n
    return requests.get(...)

# ‚úÖ CORRECTO
import requests

def my_function():
    return requests.get(...)
```

**Script de detecci√≥n:**
```bash
rg "^\s+import\s+" app/ --type py
rg "^\s+from\s+.*\s+import" app/ --type py
```

### 2. Ejecutar Ruff (Linter)

```bash
ruff check app/ --fix
```

Flags:
- `--fix` - Aplica auto-fixes seguros
- `--unsafe-fixes` - Aplica fixes que pueden cambiar comportamiento (pedir confirmaci√≥n)

### 3. Ejecutar Black (Formatter)

```bash
black app/ --check
```

Si hay diferencias:
```bash
black app/  # Aplicar formateo
```

### 4. Validar Type Hints

```bash
mypy app/ --ignore-missing-imports
```

### 5. Generar Reporte

```
üîç Lint Results:

üì¶ Imports
  ‚ùå app/services/rag_query.py:45 - Import dentro de funci√≥n
  ‚ùå app/services/vector_storage.py:78 - Import dentro de funci√≥n
  ‚úÖ Auto-fix disponible

üé® Formatting
  ‚ö†Ô∏è  15 archivos necesitan formateo
  ‚úÖ Auto-fix con: black app/

üìù Type Hints
  ‚ö†Ô∏è  app/services/create_project.py:23 - Falta type hint en retorno
  ‚ö†Ô∏è  app/infra/gemini_client.py:56 - Par√°metro sin tipo

üìè Line Length
  ‚úÖ Todas las l√≠neas < 100 caracteres

Total: 2 errores cr√≠ticos, 16 advertencias
```

### 6. Aplicar Auto-fixes

Para errores seguros, aplicar autom√°ticamente:

```python
# Detectar import dentro de funci√≥n
def move_imports_to_top(file_path: str):
    """Move all imports to the top of the file."""
    # Leer archivo
    # Extraer imports de dentro de funciones
    # Moverlos al inicio
    # Guardar archivo
```

### 7. Registrar en Learning System

Guardar patr√≥n en `.agent/errors/patterns.json`:

```json
{
  "import_inside_function": {
    "count": 15,
    "last_seen": "2026-01-15T09:30:00",
    "files_affected": [
      "app/services/rag_query.py",
      "app/services/vector_storage.py"
    ],
    "auto_fix": "Move import to top of file",
    "severity": "medium"
  }
}
```

### 8. Commit Auto-fixes (si aplica)

Si se aplicaron fixes:

```bash
git add .
git commit -m "style: auto-fix linting issues

Fixed by /lint workflow:
- Moved 15 imports to file root
- Applied black formatting to 15 files
- Fixed line length violations

ü§ñ Auto-generated by Antigravity
Co-authored-by: Claude Sonnet 4 <antigravity@deepmind.google>"
```

## Configuraci√≥n

### .ruff.toml
```toml
[lint]
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "F",   # pyflakes
    "I",   # isort (import ordering)
    "N",   # pep8-naming
]

[format]
line-length = 100
indent-width = 4

[lint.isort]
force-single-line = false
lines-after-imports = 2
```

## Auto-fix Safety Levels

### ‚úÖ Siempre Auto-fix
- Formateo (black)
- Import ordering (isort)
- Trailing whitespace
- Missing newlines

### ‚ö†Ô∏è Pedir Confirmaci√≥n
- Mover imports de dentro de funciones (puede afectar lazy loading)
- Agregar type hints (puede ser incorrecto)
- Refactorizar c√≥digo complejo

### ‚ùå Nunca Auto-fix
- Cambios de l√≥gica
- Eliminaci√≥n de c√≥digo
- Cambios en APIs p√∫blicas

## Resultado Esperado

```
‚úÖ Lint Check: PASSED

- 15 auto-fixes aplicados
- 0 errores cr√≠ticos
- 3 advertencias (no bloquean PR)

Archivos modificados:
- app/services/rag_query.py
- app/services/vector_storage.py
```
